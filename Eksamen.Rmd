---
title: "STIN100 Datasett 3: Når får barn en tarmflora som ligner på den vi ser hos voksne?"
author: "Benjamin Johan Madsen & Aksel Vardeberg Skeie"
date: "29 oktober 2018"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float:
      collapsed: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
#https://github.com/Baconscott/Eksamen.git
#Dette er linken til Github om vi trenger den
```

##1.2 Forberedelser


Følgende pakker er blitt lastet ned: ```tidyverse, ggplot2, gplots```

```{r, include = FALSE}
library(tidyverse) 
library(gplots) 
library(readxl) 
```

##2.1 Last inn dataene
```{r, Include = FALSE}
data <- read_excel("mor_barn_tid_tarmflora.xlsx") #Disse dataene er normalisert og dette er en tibbel 
```

Vi ser at i datasette er det 1124 rader  
```{r}
nrow(data)
```

og 1277 kolonner.
```{r}
ncol(data)
```

##2.2

Tabell 1: gir en oppsumering av kolonne 2:6
```{r}
summary(data[,2:6])
```

Fra tabell en ser vi at vi har følgende:

- Variabler: ```Motherchild```
- Observasjone: ```Timepoint```
- Verdier: ```Methanobrevibacter, Clostridiales, Dialister ```

##2.3
Videre skal vi sortere variablene i kolonnene ```Timepoint``` og ```Motherchild```. Vi ønsker de en en spesiel rekkefølge og den presiserer vi i koden under.
```{r}
data$Timepoint <- as.factor(data$Timepoint)
data$Timepoint <- factor(data$Timepoint, levels = c("Pregnancy", "10days",  "3months", "1year", "2years"))

data$MotherChild <- as.factor(data$MotherChild)
data$MotherChild <- factor(data$MotherChild, levels = c("mother", "child"))

levels(data$MotherChild)
levels(data$Timepoint)

View(data)
```

##3 La oss telle bakterier

##3.1 Hvor mange ulike taxon finnes i tarmfloraen til et individ?
```{r}
leke_data <- data[c(1:3,26,28,29,190,191,198,493:495,748:750,768,771,772), 1:6]
View(leke_data)
```

##2.2

Tabell 1: gir en oppsumering av kolonne 2:6
```{r}
summary(data[,2:6])
```

Fra tabell en ser vi at vi har følgende:

- Variabler: ```Motherchild```
- Observasjone: ```Timepoint```
- Verdier: ```Methanobrevibacter, Clostridiales, Dialister ```

##2.3
Videre skal vi sortere variablene i kolonnene ```Timepoint``` og ```Motherchild```. Vi ønsker de en en spesiel rekkefølge og den presiserer vi i koden under.
```{r}
data$Timepoint <- as.factor(data$Timepoint)
data$Timepoint <- factor(data$Timepoint, levels = c("Pregnancy", "10days",  "3months", "1year", "2years"))

data$MotherChild <- as.factor(data$MotherChild)
data$MotherChild <- factor(data$MotherChild, levels = c("mother", "child"))

levels(data$MotherChild)
levels(data$Timepoint)
```


##2.4 Et tilfeldig utvalg 

Ved å lage en dataramme med tilfeldigge rader fra datasette ```data``` kan vi forbrede oss på å analysere hele datasette. Vi kaller det nye datasette ```leke_data```. En av funksjonene vi ønsker å teste er ```rowSums```. Denne funksjonne kan brukes til å si hvor mange ulike bakterie typer vi finner i hvert enkelt individ. 

Tabell 2: Viser en dataramme med tilfeldigge rader og kolonne 1 til 6.
```{r}
leke_data <- data[c(1:3,26,28,29,190,191,198,493:495,748:750,768,771,772), 1:6]
leke_data

rowSums(leke_data[,-(1:3)] > 0)
```

##2.5 beregne gjenomsnittlig antall taxa som finnes i observasjons-gruppene
Videre ønsker vi å regne ut gjennomsnittet for mor og barn ved ulike tidspunkter for å se hvordan bakteriefloraen er forskjellig hos mor og barn og hvordan den endrer seg over tid. 

Første steget vår blir å forekle data vå litt. Vi slår sammen kolonne 4,5, og 6. Vi fordeler de på kolonnene Taxa og AntallBakterier. Dermed har vi samlet taxon-variablene våres i to nye variabler. Dette vil gjøre videre undersøkelser enklere. 

```{r}
leke_data %>%
  gather(Taxa, AntallBakterier, -(1:3))
```

```{r}
GjennomsnittligAntallTaxa.lekedata <- leke_data %>%
  gather(Taxa, AntallBakterier, -(1:3)) %>%
  group_by(MotherChildPairID, MotherChild, Timepoint) %>% 
  summarise(AntallTaxa = sum(AntallBakterier > 0)) %>% 
  group_by(MotherChild, Timepoint) %>% 
  summarise(GjennomsnittligAntallTaxa = mean(AntallTaxa))

GjennomsnittligAntallTaxa.lekedata
```

##2.5.1

Nå skal vi gjøre det med hele datasette vårt. Fra det vi får som output kan vi se at antall ulike arter i barn utvider seg over tid og at det er vesentlig mere bakterier i mor enn bar. 
```{r}
GjennomsnittligAntallTaxa <- data %>%
  gather(Taxa, AntallBakterier, -(1:3)) %>%
  group_by(MotherChildPairID, MotherChild, Timepoint) %>% 
  summarise(AntallTaxa = sum(AntallBakterier > 0)) %>% 
  group_by(MotherChild, Timepoint) %>% 
  summarise(GjennomsnittligAntallTaxa = mean(AntallTaxa))

GjennomsnittligAntallTaxa
```

##2.5.2

Etter å ha plottet dataen i et boksplott ser vi nå at  antall ulike typer bakterier for et indevid varierer mer med alderen. 

Figur 1:
```{r}
library(ggplot2)

Gjennomsnitt.taksa <- data %>%
  gather(Taxa, AntallBakterier, -(1:3)) %>%
  group_by(MotherChildPairID, MotherChild, Timepoint) %>% 
  summarise(AntallTaxa = sum(AntallBakterier > 0))

ggplot(Gjennomsnitt.taksa, aes(Timepoint, AntallTaxa, fill = MotherChild)) + geom_boxplot() + facet_grid(rows =  vars(Gjennomsnitt.taksa$MotherChild), scales = "free", space = "free") + coord_flip()
```

##3.2 Hvilke taxa er mest vanlige?